<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gerar √çcones Maskable Nexus</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 40px;
            background: #1a1a1a;
            color: white;
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            background: linear-gradient(to right, #2256FF, #00D4AA, #00D4D4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .container {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 16px;
            margin: 20px 0;
        }
        input[type="file"] {
            background: #3a3a3a;
            color: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #444;
            width: 100%;
            margin: 10px 0;
        }
        button {
            background: linear-gradient(to right, #2256FF, #00D4AA);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        canvas {
            border: 3px solid #444;
            margin: 15px 0;
            border-radius: 12px;
            background: white;
        }
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .preview-item {
            background: #3a3a3a;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .safe-zone {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
            background: #2a2a2a;
            border-radius: 12px;
        }
        .safe-zone::before {
            content: '';
            position: absolute;
            top: 10%;
            left: 10%;
            right: 10%;
            bottom: 10%;
            border: 2px dashed #00D4AA;
            border-radius: 50%;
        }
        .info {
            background: #3a3a3a;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #00D4AA;
            margin: 20px 0;
        }
        .warning {
            background: #4a3a2a;
            border-left-color: #ff9500;
        }
    </style>
</head>
<body>
    <h1>üé® Gerador de √çcones Maskable - Nexus</h1>

    <div class="info">
        <h3>üìã Como funciona:</h3>
        <ol>
            <li>Carregue o √≠cone atual (icon-512x512.png)</li>
            <li>O script vai redimensionar para <strong>60% do tamanho</strong></li>
            <li>Adicionar fundo <strong>#FFFFFF</strong> (branco)</li>
            <li>Gerar vers√µes 192x192 e 512x512</li>
            <li>Fazer download e substituir no projeto</li>
        </ol>
    </div>

    <div class="container">
        <h2>1Ô∏è‚É£ Selecione o √≠cone original</h2>
        <input type="file" id="imageInput" accept="image/*">

        <div class="safe-zone" id="safeZone">
            <canvas id="previewCanvas" width="200" height="200"></canvas>
        </div>
        <p style="text-align: center; color: #aaa;">
            ‚¨ÜÔ∏è Preview - A √°rea pontilhada verde √© a "safe zone"<br>
            O Android pode cortar at√© 20% das bordas
        </p>
    </div>

    <div class="container">
        <h2>2Ô∏è‚É£ Gerar √≠cones maskable</h2>
        <button onclick="generateMaskableIcons()" style="width: 100%;">
            ‚ú® Gerar √çcones Maskable (com padding correto)
        </button>
    </div>

    <div id="output" class="preview-grid"></div>

    <script>
        let originalImage = null;

        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    originalImage = img;
                    showPreview(img);
                }
                img.src = event.target.result;
            }

            reader.readAsDataURL(file);
        });

        function showPreview(img) {
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');

            // Limpar
            ctx.clearRect(0, 0, 200, 200);

            // Fundo Branco
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, 200, 200);

            // Desenhar imagem reduzida (60% = 120px em um canvas de 200px)
            const iconSize = 200 * 0.6;
            const offset = (200 - iconSize) / 2;
            ctx.drawImage(img, offset, offset, iconSize, iconSize);

            // Desenhar safe zone circle
            ctx.strokeStyle = '#00D4AA';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(100, 100, 80, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function generateMaskableIcons() {
            if (!originalImage) {
                alert('‚ùå Por favor, carregue uma imagem primeiro!');
                return;
            }

            const sizes = [192, 512];
            const output = document.getElementById('output');
            output.innerHTML = '<h2 style="grid-column: 1/-1;">‚úÖ √çcones Gerados:</h2>';

            sizes.forEach(size => {
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');

                // Fundo Branco
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, size, size);

                // √çcone reduzido para 60% (deixando 20% de padding em cada lado)
                const iconSize = size * 0.6;
                const offset = (size - iconSize) / 2;

                // Desenhar o √≠cone redimensionado no centro
                ctx.drawImage(originalImage, offset, offset, iconSize, iconSize);

                // Container para cada √≠cone
                const container = document.createElement('div');
                container.className = 'preview-item';

                const title = document.createElement('h3');
                title.textContent = `${size}x${size}`;
                title.style.marginTop = '0';
                container.appendChild(title);

                // Redimensionar canvas para preview
                const previewCanvas = document.createElement('canvas');
                previewCanvas.width = 150;
                previewCanvas.height = 150;
                const previewCtx = previewCanvas.getContext('2d');
                previewCtx.drawImage(canvas, 0, 0, 150, 150);
                container.appendChild(previewCanvas);

                const filename = `icon-${size}x${size}-maskable.png`;
                const info = document.createElement('p');
                info.innerHTML = `<strong>${filename}</strong><br><small>${(canvas.toDataURL().length / 1024).toFixed(1)} KB</small>`;
                container.appendChild(info);

                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = `‚¨áÔ∏è Download`;
                downloadBtn.onclick = () => downloadCanvas(canvas, filename);
                container.appendChild(downloadBtn);

                output.appendChild(container);
            });

            // Adicionar instru√ß√µes finais
            const instructions = document.createElement('div');
            instructions.className = 'info warning';
            instructions.style.gridColumn = '1/-1';
            instructions.innerHTML = `
                <h3>‚ö†Ô∏è Pr√≥ximos passos:</h3>
                <ol>
                    <li>Fa√ßa download dos dois √≠cones</li>
                    <li>Substitua os arquivos na pasta <code>nexus-frontend/public/icons/</code></li>
                    <li>Commit e push das mudan√ßas</li>
                    <li>No Android: <strong>desinstale o PWA e reinstale</strong> para ver o novo √≠cone</li>
                </ol>
            `;
            output.appendChild(instructions);
        }

        function downloadCanvas(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>
</html>
